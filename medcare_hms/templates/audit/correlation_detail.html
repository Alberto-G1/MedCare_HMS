{% extends 'base.html' %}
{% block title %}Correlation {{ correlation_id }} | MedCare HMS{% endblock %}
{% block content %}
<div class="container-fluid fade-in-up">
  <h2 class="mb-3">Correlation Detail</h2>
  <p class="text-muted">All events that occurred under correlation <code>{{ correlation_id }}</code></p>
  <a href="{% url 'audit:audit_feed' %}?cid={{ correlation_id }}" class="btn btn-outline-secondary btn-sm mb-3">Back to Feed</a>
  <div class="timeline">
    {% for log in logs %}
      <div class="card mb-2 shadow-sm">
        <div class="card-body py-2">
          <div class="d-flex justify-content-between">
            <div>
              <strong>{{ log.action }}</strong>
              <small class="text-muted ms-2">{{ log.created_at|date:'Y-m-d H:i:s' }}</small><br>
              <small>Actor: {% if log.actor %}{{ log.actor.username }}{% else %}â€”{% endif %} | Target: {{ log.target_model }}#{{ log.target_id }}</small>
              {% if log.summary %}<div class="mt-1"><small>{{ log.summary }}</small></div>{% endif %}
            </div>
            {% if log.details %}
              <button class="btn btn-sm btn-link" data-bs-toggle="collapse" data-bs-target="#d{{ forloop.counter }}">Details</button>
            {% endif %}
          </div>
          {% if log.details %}
          <div id="d{{ forloop.counter }}" class="collapse mt-2">
            <pre class="small bg-light p-2 border rounded" style="max-height:240px; overflow:auto;">{{ log.details|json_script:'_ignore' }}</pre>
          </div>
          {% endif %}
        </div>
      </div>
    {% empty %}
      <p class="text-muted">No events.</p>
    {% endfor %}
  </div>
</div>
{% endblock %}
